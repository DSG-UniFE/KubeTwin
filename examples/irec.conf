start_time DateTime.civil(2020,5,28,0,0,0).to_time
warmup_duration 0.seconds
cooldown_duration 0.seconds

duration 10000.seconds
seeds \
  {communication_latencies 12345}
#stats_print_interval 1

seed 12345

clusters \
  one: {
    name: "eu-south-1 - Local DC",
    location_id: 1,
    type: :mec,
    tier: "local",
    node_number: 1, 
    node_resources_cpu: 10000, 
    node_resources_memory: 10000,
  }


latency_models \
  [
    # 0 end-user location
    [
      # 0 0 -- end-user end-user (not-used)
      {
        distribution: :gaussian, args: {mean: 0.100E-10, sd: 0.50E-10, seed: seed}
      },
      {
        distribution: :gaussian, args: {mean: 0.100E-10, sd: 0.50E-10, seed: seed}
        #distribution: :gaussian, args: {mean: 0.1E-3, sd: 0.3E-4, seed: seed}
      }
    ],
    # 1 location
    [
      # location 1 - 1 
      # these are intra-dc (for node in the same cluster)
      # 0 1 -- end-user- cluster (use )
      {
        #distribution: :gaussian, args: {mean: 0.100E-10, sd: 0.50E-10, seed: seed}
        distribution: :gaussian, args: {mean: 0.1E-6, sd: 0.3E-7, seed: seed}
      }
      #{
      #  distribution: :mixture,
      #  args: ERV::GaussianMixtureHelper.RawParametersToMixtureArgs(
      #    33, 9.24E-6, 1.69E-6, 33, 10.87E-6, 1.73E-6, 33, 11.19E-6, 1.40E-6), seed: seed
      #}
    ]
  ]


# MEC location is 1

# customers located at Local DC -- downtown 

customers \
  1 => { location_id: 0 }

=begin
request_gen \
1 => {
  workflow_types: 1,
  # request_distribution: {distribution: :exponential, args: { rate: 1 / 0.03766478342749529, seed: seed }},
  request_distribution: {distribution: :exponential, args: { rate: 0.5, seed: seed }},
  num_requests: 2000,
  num_customers: 1
}
=end

request_generation \
  filename: '/Users/filippo/Downloads/kt-measure/threaded-mode/req_logs_1663822993.7852924_rps20.0_nreq5000.csv'
# filename: '/Users/filippo/Downloads/measures_with_replicas/replica1/r1_c5.csv'
# filename: '/Users/filippo/Downloads/measures_with_replicas/replica1/r1_c5.csv'


# all microservices have an equal service time for mec or cloud resources
# generated from workstation
# model fit
microservice_types \
"MS1"=>{:service_time_distribution=>{:mec=>{:distribution=>:mixture, :args=>[{:distribution=>:gaussian, :weight=>0.0001833783445116481, :args=>{:mean=>0.04454873516937691, :sd=>0.030638542814007266, :seed=>12345}}, {:distribution=>:gaussian, :weight=>1.0648808259206003e-05, :args=>{:mean=>0.03667341619922896, :sd=>0.0019114395341349093, :seed=>12345}}, {:distribution=>:gaussian, :weight=>0.026922996889284793, :args=>{:mean=>0.002869503149815971, :sd=>0.02723776497243141, :seed=>12345}}]}, :cloud=>{:distribution=>:gaussian, :args=>{:mean=>0.053011, :sd=>0.006149, :seed=>12345}}}, :resources_requirements_cpu=>30, :resources_requirements_memory=>25, :node_affinity=>"local", :wait_for=>["MS2"]}, 
"MS2"=>{:service_time_distribution=>{:mec=>{:distribution=>:mixture, :args=>[{:distribution=>:gaussian, :weight=>8.638420935349077e-05, :args=>{:mean=>0.05136612990075034, :sd=>0.01170713734583719, :seed=>12345}}, {:distribution=>:gaussian, :weight=>1.2642066308403303e-05, :args=>{:mean=>0.011585114840147058, :sd=>0.019874769064122923, :seed=>12345}}, {:distribution=>:gaussian, :weight=>0.0049402744860962845, :args=>{:mean=>0.0331362889584799, :sd=>0.0049801899650801194, :seed=>12345}}]}, :cloud=>{:distribution=>:gaussian, :args=>{:mean=>0.053011, :sd=>0.006149, :seed=>12345}}}, :resources_requirements_cpu=>30, :resources_requirements_memory=>25, :node_affinity=>"local"}
=begin
"MS1"=>{:service_time_distribution=>{:mec=>{:distribution=>:mixture, :args=>[{:distribution=>:gaussian, :weight=>0.00037452594556742136, :args=>{:mean=>0.014485147325151097, :sd=>0.0027376304853990955, :seed=>12345}}, {:distribution=>:gaussian, :weight=>1.1619715812037165e-05, :args=>{:mean=>0.012978010216774435, :sd=>0.02723859672191673, :seed=>12345}}, {:distribution=>:gaussian, :weight=>0.0008842800917172323, :args=>{:mean=>0.008257938871653043, :sd=>0.0010249352334947939, :seed=>12345}}]}, :cloud=>{:distribution=>:gaussian, :args=>{:mean=>0.053011, :sd=>0.006149, :seed=>12345}}}, :resources_requirements_cpu=>30, :resources_requirements_memory=>25, :node_affinity=>"local", :wait_for=>["MS2"]}, 
"MS2"=>{:service_time_distribution=>{:mec=>{:distribution=>:mixture, :args=>[{:distribution=>:gaussian, :weight=>2.8162680725127555e-06, :args=>{:mean=>0.007582780092974051, :sd=>0.01230777580083251, :seed=>12345}}, {:distribution=>:gaussian, :weight=>3.196102599113643e-05, :args=>{:mean=>0.1, :sd=>0.002627512741861628, :seed=>12345}}, {:distribution=>:gaussian, :weight=>0.005798078470704116, :args=>{:mean=>0.03611063906827012, :sd=>0.005870834581117498, :seed=>12345}}]}, :cloud=>{:distribution=>:gaussian, :args=>{:mean=>0.053011, :sd=>0.006149, :seed=>12345}}}, :resources_requirements_cpu=>30, :resources_requirements_memory=>25, :node_affinity=>"local"}
=begin
"MS1"=>{:service_time_distribution=>{:mec=>{:distribution=>:mixture, :args=>[{:distribution=>:gaussian, :weight=>1.5559918805546257e-06, :args=>{:mean=>0.02364657547134185, :sd=>0.00011088479895506781, :seed=>12345}}, {:distribution=>:gaussian, :weight=>0.0002479463056084313, :args=>{:mean=>0.0128335527127036, :sd=>0.0029212949417446944, :seed=>12345}}, {:distribution=>:gaussian, :weight=>9.02857626051799e-05, :args=>{:mean=>0.006568450644341784, :sd=>0.0001001959414638289, :seed=>12345}}]}, :cloud=>{:distribution=>:gaussian, :args=>{:mean=>0.053011, :sd=>0.006149, :seed=>12345}}}, :resources_requirements_cpu=>30, :resources_requirements_memory=>25, :node_affinity=>"local", :wait_for=>["MS2"]}, 
"MS2"=>{:service_time_distribution=>{:mec=>{:distribution=>:mixture, :args=>[{:distribution=>:gaussian, :weight=>1.5063164190206628e-07, :args=>{:mean=>0.005686473265417728, :sd=>0.0001, :seed=>12345}}, {:distribution=>:gaussian, :weight=>1.3532036677214573e-07, :args=>{:mean=>0.0009800664642672986, :sd=>0.002085403097733778, :seed=>12345}}, {:distribution=>:gaussian, :weight=>0.004992552471047289, :args=>{:mean=>0.033279467937050985, :sd=>0.005000409142536344, :seed=>12345}}]}, :cloud=>{:distribution=>:gaussian, :args=>{:mean=>0.053011, :sd=>0.006149, :seed=>12345}}}, :resources_requirements_cpu=>30, :resources_requirements_memory=>25, :node_affinity=>"local"}
=begin
"MS1"=>{:service_time_distribution=>
{:mec=> {distribution: :mixture, args: ERV::GaussianMixtureHelper.RawParametersToMixtureArgs(
0.34685706490530543,0.012048922615526703,0.0016168402258217244E-3,
0.33436284049647114,0.006414445773817597,0.0014297654346297054E-3,
0.13548864141653127,0.012986815309454385,0.0021155570330358992E-3,
0.18329145318169215,0.008667592655268105,0.001989164547569761E-3,
)},
:cloud=>{:distribution=>:gaussian, :args=>{:mean=>0.053011, :sd=>0.006149, :seed=>12345}}},
:resources_requirements_cpu=>30, :resources_requirements_memory=>25, :node_affinity=>"local", :wait_for => ["MS2"]}, 
"MS2"=>{:service_time_distribution=>
{:mec=>{distribution: :mixture, args: ERV::GaussianMixtureHelper.RawParametersToMixtureArgs(
0.16027470513648784,0.025380233638142194,0.0018797219254954205E-3,
0.30263735138029224,0.031180618930144635,0.0017347472966440915E-3,
0.00020072260136491408,0.35598333676656063,0.0022943636109865892E-3,
0.016075240257753042,0.043347942939461974,0.005538840081552029E-3,
0.14489259912815647,0.03344565559321486,0.001966975111341917E-3,
0.22306713070623627,0.02367635380135023,0.0015556659135012518E-3,
0.040035068208074946,0.03810931704641024,0.002584465640034423E-3,
0.11281718258163421,0.028533338698687835,0.002047871350509455E-3,
)},:cloud=>{:distribution=>:gaussian, :args=>{:mean=>0.053011, :sd=>0.006149, :seed=>12345}}}, 
:resources_requirements_cpu=>30, :resources_requirements_memory=>25, :node_affinity=>"local"}
=begin
"MS1"=>{:service_time_distribution=>
{:mec=> {distribution: :gaussian, args: {mean: 0.007913609, sd: 0.00229191, seed: seed}},
 :cloud=>{:distribution=>:gaussian, :args=>{:mean=>0.053011, :sd=>0.006149, :seed=>12345}}},
:resources_requirements_cpu=>30, :resources_requirements_memory=>25, :node_affinity=>"local", :wait_for => ["MS2"]}, 
"MS2"=>{:service_time_distribution=>
{:mec=>{distribution: :gaussian, args: {mean: 0.0289486, sd: 0.004604541, seed: seed}},
 :cloud=>{:distribution=>:gaussian, :args=>{:mean=>0.053011, :sd=>0.004780014, :seed=>12345}}}, :resources_requirements_cpu=>30, :resources_requirements_memory=>25, :node_affinity=>"local"}
=begin
"MS1"=>{:service_time_distribution=>
{:mec=> {distribution: :mixture, args: ERV::GaussianMixtureHelper.RawParametersToMixtureArgs(
0.18324521631064072,0.008672784317406475,0.0019897960932160285E-3,
0.1344069631654622,0.012990034138675088,0.002119043333708209E-3,
0.34766096191669915,0.012051851323288948,0.001616275038889984E-3,
0.33468685860719805,0.0064152873093474465,0.00143021533068045E-3,
)},
 :cloud=>{:distribution=>:gaussian, :args=>{:mean=>0.053011, :sd=>0.006149, :seed=>12345}}},
:resources_requirements_cpu=>30, :resources_requirements_memory=>25, :node_affinity=>"local", :wait_for => ["MS2"]}, 
"MS2"=>{:service_time_distribution=>
{:mec=>{distribution: :mixture, args: ERV::GaussianMixtureHelper.RawParametersToMixtureArgs(
0.2674604396922663,0.031460238015686565,0.0018986392788740264E-3,
6.722689075630293e-05,0.42221045494079495,0.001E-3,
0.1992686539415637,0.024166381176725704,0.0017306086245523148E-3,
0.13167767308858894,0.03761099225525663,0.0021105495929309363E-3,
0.00678793666267944,0.05267900219823988,0.007769614885888351E-3,
0.12858647610417495,0.027623019616133167,0.002167895241298983E-3,
0.03557533608614161,0.04330639431379471,0.003002457834234478E-3,
0.00013445378151260572,0.3567134141921993,0.002407720379705012E-3,
0.23044180375231624,0.03476321040827447,0.0019687631004938365E-3,
)},
 :cloud=>{:distribution=>:gaussian, :args=>{:mean=>0.053011, :sd=>0.006149, :seed=>12345}}}, :resources_requirements_cpu=>30, :resources_requirements_memory=>25, :node_affinity=>"local"}
=begin
"MS1"=>{:service_time_distribution=>{:mec=>{:distribution=>:mixture, :args=>[{:distribution=>:gaussian, :weight=>1.5559918805546257e-06, :args=>{:mean=>0.02364657547134185, :sd=>0.00011088479895506781, :seed=>12345}}, {:distribution=>:gaussian, :weight=>0.0002479463056084313, :args=>{:mean=>0.0128335527127036, :sd=>0.0029212949417446944, :seed=>12345}}, {:distribution=>:gaussian, :weight=>9.02857626051799e-05, :args=>{:mean=>0.006568450644341784, :sd=>0.0001001959414638289, :seed=>12345}}]}, :cloud=>{:distribution=>:gaussian, :args=>{:mean=>0.053011, :sd=>0.006149, :seed=>12345}}}, :resources_requirements_cpu=>30, :resources_requirements_memory=>25, :node_affinity=>"local", :wait_for=>["MS2"]}, 
"MS2"=>{:service_time_distribution=>{:mec=>{:distribution=>:mixture, :args=>[{:distribution=>:gaussian, :weight=>1.5063164190206628e-07, :args=>{:mean=>0.005686473265417728, :sd=>0.0001, :seed=>12345}}, {:distribution=>:gaussian, :weight=>1.3532036677214573e-07, :args=>{:mean=>0.0009800664642672986, :sd=>0.002085403097733778, :seed=>12345}}, {:distribution=>:gaussian, :weight=>0.004992552471047289, :args=>{:mean=>0.033279467937050985, :sd=>0.005000409142536344, :seed=>12345}}]}, :cloud=>{:distribution=>:gaussian, :args=>{:mean=>0.053011, :sd=>0.006149, :seed=>12345}}}, :resources_requirements_cpu=>30, :resources_requirements_memory=>25, :node_affinity=>"local"}
=begin
"MS1"=>{:service_time_distribution=>
{:mec=> {distribution: :gaussian, args: {mean: 0.01043614, sd: 0.003343094, seed: seed}},
 :cloud=>{:distribution=>:gaussian, :args=>{:mean=>0.053011, :sd=>0.006149, :seed=>12345}}},
:resources_requirements_cpu=>30, :resources_requirements_memory=>25, :node_affinity=>"local", :wait_for => ["MS2"]}, 
"MS2"=>{:service_time_distribution=>
{:mec=>{distribution: :gaussian, args: {mean: 0.03208513, sd: 0.004976145, seed: seed}},
 :cloud=>{:distribution=>:gaussian, :args=>{:mean=>0.053011, :sd=>0.006149, :seed=>12345}}}, :resources_requirements_cpu=>30, :resources_requirements_memory=>25, :node_affinity=>"local"}
=begin
"MS1"=>{:service_time_distribution=>{:mec=>{:distribution=>:mixture, :args=>[{:distribution=>:gaussian, :weight=>1.5559918805546257e-06, :args=>{:mean=>0.02364657547134185, :sd=>0.00011088479895506781, :seed=>12345}}, {:distribution=>:gaussian, :weight=>0.0002479463056084313, :args=>{:mean=>0.0128335527127036, :sd=>0.0029212949417446944, :seed=>12345}}, {:distribution=>:gaussian, :weight=>9.02857626051799e-05, :args=>{:mean=>0.006568450644341784, :sd=>0.0001001959414638289, :seed=>12345}}]}, :cloud=>{:distribution=>:gaussian, :args=>{:mean=>0.053011, :sd=>0.006149, :seed=>12345}}}, :resources_requirements_cpu=>30, :resources_requirements_memory=>25, :node_affinity=>"local", :wait_for=>["MS2"]}, 
"MS2"=>{:service_time_distribution=>{:mec=>{:distribution=>:mixture, :args=>[{:distribution=>:gaussian, :weight=>1.5063164190206628e-07, :args=>{:mean=>0.005686473265417728, :sd=>0.0001, :seed=>12345}}, {:distribution=>:gaussian, :weight=>1.3532036677214573e-07, :args=>{:mean=>0.0009800664642672986, :sd=>0.002085403097733778, :seed=>12345}}, {:distribution=>:gaussian, :weight=>0.004992552471047289, :args=>{:mean=>0.033279467937050985, :sd=>0.005000409142536344, :seed=>12345}}]}, :cloud=>{:distribution=>:gaussian, :args=>{:mean=>0.053011, :sd=>0.006149, :seed=>12345}}}, :resources_requirements_cpu=>30, :resources_requirements_memory=>25, :node_affinity=>"local"}
=begin
"MS1"=>{:service_time_distribution=>
{:mec=> {distribution: :gaussian, args: {mean: 0.01043614, sd: 0.003343094, seed: seed}},
 :cloud=>{:distribution=>:gaussian, :args=>{:mean=>0.053011, :sd=>0.006149, :seed=>12345}}},
:resources_requirements_cpu=>30, :resources_requirements_memory=>25, :node_affinity=>"local", :wait_for => ["MS2"]}, 
"MS2"=>{:service_time_distribution=>
{:mec=>{distribution: :gaussian, args: {mean: 0.03208513, sd: 0.004976145, seed: seed}},
 :cloud=>{:distribution=>:gaussian, :args=>{:mean=>0.053011, :sd=>0.006149, :seed=>12345}}}, :resources_requirements_cpu=>30, :resources_requirements_memory=>25, :node_affinity=>"local"}
=begin
"MS1"=>{:service_time_distribution=>
{:mec=> {distribution: :gaussian, args: {mean: 0.01143607, sd: 0.00301789, seed: seed}},
 :cloud=>{:distribution=>:gaussian, :args=>{:mean=>0.053011, :sd=>0.006149, :seed=>12345}}},
:resources_requirements_cpu=>30, :resources_requirements_memory=>25, :node_affinity=>"local", :wait_for => ["MS2"]}, 
"MS2"=>{:service_time_distribution=>
{:mec=>{distribution: :gaussian, args: {mean: 0.03074308, sd: 0.004740396, seed: seed}},
 :cloud=>{:distribution=>:gaussian, :args=>{:mean=>0.053011, :sd=>0.006149, :seed=>12345}}}, :resources_requirements_cpu=>30, :resources_requirements_memory=>25, :node_affinity=>"local"}
=begin
"MS1"=>{:service_time_distribution=>{:mec=>{:distribution=>:mixture, :args=>[{:distribution=>:gaussian, :weight=>9.811598858779944e-05, :args=>{:mean=>0.007160269823213679, :sd=>0.0063682261762834785, :seed=>12345}}, {:distribution=>:gaussian, :weight=>9.306571809554428e-05, :args=>{:mean=>0.02227133015322898, :sd=>0.03717479609753065, :seed=>12345}}, {:distribution=>:gaussian, :weight=>0.010839739645328157, :args=>{:mean=>0.005012309274568196, :sd=>0.011037426320116384, :seed=>12345}}]}, :cloud=>{:distribution=>:gaussian, :args=>{:mean=>0.053011, :sd=>0.006149, :seed=>12345}}}, 
:resources_requirements_cpu=>30, 
:resources_requirements_memory=>25, 
:wait_for => ["MS2"],
:node_affinity=>"local"},
"MS2"=>{:service_time_distribution=>{:mec=>{:distribution=>:mixture, 
:args=>[{:distribution=>:gaussian, :weight=>0.0013544096931170592, :args=>{:mean=>0.006910477307608723, :sd=>0.0036099000885854195, :seed=>12345}}, {:distribution=>:gaussian, :weight=>0.0020905812130319374, :args=>{:mean=>0.016116386025725384, :sd=>0.11568954739239289, :seed=>12345}}, {:distribution=>:gaussian, :weight=>0.0051558487990229825, :args=>{:mean=>0.004718772854840048, :sd=>0.008497677046634683, :seed=>12345}}]}, :cloud=>{:distribution=>:gaussian, :args=>{:mean=>0.053011, :sd=>0.006149, :seed=>12345}}}, :resources_requirements_cpu=>30, :resources_requirements_memory=>25, :node_affinity=>"local"}
=end

services \
  'MS1' => {
    serviceName: 'Service1',
    selector: 'MS1'
  },
  'MS2' => {
    serviceName: 'Service2',
    selector: 'MS2'
  }

replica_sets \
  'app' => {
      name: 'rs_1',
      selector: 'MS1',
      replicas: 1,
  },
  'app2' => {
      name: 'rs_2',
      selector: 'MS2',
      replicas: 1,
  }


workflow_types \
  1 => {
    component_sequence: [
      { name: 'MS1' }, 
      { name: 'MS2' },
    ],
  }

# just an example of a custom stats here ---
# so we can collect the data for the Experimental Result
# section

custom_stats \
  [
    { workflow_type_id: 1, customer_id: 1, longer_than: [35.msecs, 45.msecs, 50.msecs, 55.msecs, 60.msecs, 65.msecs] },
  ]

evaluation \
  cluster_hourly_cost: [
    { cluster: :one, fixed_cpu_hourly_cost: 0.100, fixed_memory_hourly_cost: 0.100 },
    { cluster: :two, fixed_cpu_hourly_cost: 0.300, fixed_memory_hourly_cost: 0.250 },
    { cluster: :three, fixed_cpu_hourly_cost: 0.300, fixed_memory_hourly_cost: 0.315 },
    { cluster: :four, fixed_cpu_hourly_cost: 0.500, fixed_memory_hourly_cost: 0.315 },
    { cluster: :five, fixed_cpu_hourly_cost: 0.500, fixed_memory_hourly_cost: 0.315 },
    { cluster: :six, fixed_cpu_hourly_cost: 0.600, fixed_memory_hourly_cost: 0.315 },
    { cluster: :seven, fixed_cpu_hourly_cost: 0.600, fixed_memory_hourly_cost: 0.315 },
  ],

  penalties: lambda {|general_stats, per_workflow_and_customer_stats|
    # 500$ penalties if MTTR takes more than 50 msecs
    500.0 if general_stats.mean > 0.500
  }
